# Swarm Templates

Shared documentation templates for swarm commands (`/swarm`, `/resolve-swarm-issue`, `/resolve-swarm-issue-long`).

## Purpose

Instead of embedding hundreds of lines of instructions in Queen/Planner prompts, we:
1. Generate thin prompts that reference these templates
2. Copy templates to session `docs/` and `phases/` folders
3. Agents read what they need, when they need it

## Template Files

### Reference Docs (copied to `docs/`)
| File | Purpose |
|------|---------|
| `model-selection.md` | Which model for which role |
| `spawn-templates.md` | mprocs spawn commands |
| `log-protocol.md` | How to log messages |

**Note**: Commands copy these to session `docs/` folder with placeholders replaced.

### Phase Instructions (copied to `phases/`)
| File | Purpose |
|------|---------|
| `phase-1-planning.md` | Task generation (Queen writes Planner prompts, Planners write worker tasks) |
| `phase-2-execution.md` | Worker execution (spawn order, monitoring) |
| `phase-3-review.md` | Review cycle (reviewer → resolver → tester) |
| `phase-4-integration.md` | Integration (Queen only - cross-domain review) |
| `phase-5-commit.md` | Curate learnings, commit & PR (Queen only) |
| `phase-6-code-quality.md` | Monitor PR, spawn agents to fix review comments (Queen only) |

## Session Directory Structure

When a swarm command runs, it creates:

```
.swarm/sessions/{SESSION_ID}/
├── docs/                           # Copied from swarm-templates
│   ├── model-selection.md
│   ├── spawn-templates.md          # With {SESSION_ID} and {MPROCS_PORT} replaced
│   └── log-protocol.md
│
├── phases/                         # Copied from swarm-templates
│   ├── phase-1-planning.md
│   ├── phase-2-execution.md
│   ├── phase-3-review.md
│   ├── phase-4-integration.md
│   └── phase-5-commit.md
│
├── state/                          # Generated during setup
│   ├── context.md                  # Task/issue description
│   ├── responsibility-matrix.md    # Domain assignments
│   ├── file-ownership.md           # File → Planner mapping
│   ├── session-guidelines.md       # Learnings from .ai-docs
│   ├── tasks.json                  # Session metadata
│   └── integration-*.md            # Phase 4 outputs
│
├── tasks/                          # Generated by Planners
│   ├── planner-a/
│   │   ├── tasks.json              # Planner's task breakdown
│   │   ├── worker-1a-task.md       # Worker task files
│   │   ├── reviewer-a-task.md
│   │   ├── review-findings.md      # Phase 3 outputs
│   │   ├── test-results.md
│   │   └── summary.md
│   └── planner-b/
│       └── ...
│
├── logs/                           # All agent logs
│   ├── queen.log
│   ├── coordination.log
│   ├── planner-a.log
│   ├── worker-1a.log
│   └── ...
│
├── queen-prompt.md                 # Thin prompt
└── planner-{X}-prompt.md           # Thin prompts
```

## Thin Prompt Pattern

Instead of:
```markdown
# Queen Agent

You are the Queen orchestrating a hierarchical swarm...
{500 lines of instructions}
```

We do:
```markdown
# Queen

**Role**: Top-level swarm orchestrator.

## Session
- ID: {SESSION_ID}
- Path: .swarm/sessions/{SESSION_ID}/

## Read First
1. docs/model-selection.md
2. docs/spawn-templates.md
3. docs/log-protocol.md
4. state/responsibility-matrix.md
5. state/file-ownership.md

## Execute Phases
1. phases/phase-1-planning.md
2. Monitor until all Planners complete
3. phases/phase-4-integration.md
4. phases/phase-5-commit.md

## Begin
Log STARTED, execute Phase 1.
```

## Benefits

1. **Smaller context** - Agents don't carry instructions they don't need yet
2. **Easier updates** - Change one template file, all commands benefit
3. **Debuggable** - Can read phase files to see exactly what agent should do
4. **Transparent** - Documentation lives in session folder, visible to all agents
5. **Consistent** - Same phase instructions across all swarm types

## How Commands Use Templates

1. **Setup**: Command copies templates to session folder, replacing placeholders
2. **Queen prompt**: Just says "read docs/ and phases/"
3. **Planner prompt**: Just says "read your tasks from tasks/planner-X/"
4. **Worker prompt**: Just says "read state/session-guidelines.md and execute"

## Placeholders

Templates use these placeholders (replaced during session setup):

| Placeholder | Value |
|-------------|-------|
| `{SESSION_ID}` | Session identifier |
| `{MPROCS_PORT}` | mprocs server port |
| `{X}` | Planner letter (a, b, c...) |
| `{N}` | Worker number (1, 2, 3, 4) |
| `{DOMAIN}` | Planner's domain name |
| `{ISSUE_NUMBER}` | GitHub issue number (resolve-* commands) |
| `{BASE_BRANCH}` | Git base branch |
